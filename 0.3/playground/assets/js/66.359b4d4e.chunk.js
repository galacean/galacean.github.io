(window.webpackJsonp=window.webpackJsonp||[]).push([[66],{491:function(e,n,A){"use strict";A.r(n),n.default='import { OrbitControl } from "@oasis-engine/controls";\nimport { FramebufferPicker } from "@oasis-engine/framebuffer-picker";\nimport {\n  AssetType,\n  Camera,\n  Color,\n  EnvironmentMapLight,\n  GLTFResource,\n  LoadItem,\n  Logger,\n  SystemInfo,\n  TextureCubeMap,\n  Vector3,\n  WebGLEngine\n} from "oasis-engine";\n\nLogger.enable();\n\nconst engine = new WebGLEngine("o3-demo");\nengine.canvas.width = window.innerWidth * SystemInfo.devicePixelRatio;\nengine.canvas.height = window.innerHeight * SystemInfo.devicePixelRatio;\nconst scene = engine.sceneManager.activeScene;\nconst rootNode = scene.createRootEntity();\n//-- create engine object\n\nlet envLightNode = rootNode.createChild("env_light");\nlet envLight = envLightNode.addComponent(EnvironmentMapLight);\n\n//-- create camera\nlet cameraNode = rootNode.createChild("camera_node");\ncameraNode.transform.position = new Vector3(0, 0, 30);\nconst camera = cameraNode.addComponent(Camera);\ncameraNode.addComponent(OrbitControl);\n\nconst resources: LoadItem[] = [\n  { url: "https://gw.alipayobjects.com/os/bmw-prod/83219f61-7d20-4704-890a-60eb92aa6159.gltf" },\n  {\n    urls: [\n      "https://gw.alipayobjects.com/mdn/rms_7c464e/afts/img/A*Bk5FQKGOir4AAAAAAAAAAAAAARQnAQ",\n      "https://gw.alipayobjects.com/mdn/rms_7c464e/afts/img/A*_cPhR7JMDjkAAAAAAAAAAAAAARQnAQ",\n      "https://gw.alipayobjects.com/mdn/rms_7c464e/afts/img/A*trqjQp1nOMQAAAAAAAAAAAAAARQnAQ",\n      "https://gw.alipayobjects.com/mdn/rms_7c464e/afts/img/A*_RXwRqwMK3EAAAAAAAAAAAAAARQnAQ",\n      "https://gw.alipayobjects.com/mdn/rms_7c464e/afts/img/A*q4Q6TroyuXcAAAAAAAAAAAAAARQnAQ",\n      "https://gw.alipayobjects.com/mdn/rms_7c464e/afts/img/A*DP5QTbTSAYgAAAAAAAAAAAAAARQnAQ"\n    ],\n    type: AssetType.TextureCube\n  },\n  {\n    urls: [\n      "https://gw.alipayobjects.com/mdn/rms_7c464e/afts/img/A*5w6_Rr6ML6IAAAAAAAAAAAAAARQnAQ",\n      "https://gw.alipayobjects.com/mdn/rms_7c464e/afts/img/A*TiT2TbN5cG4AAAAAAAAAAAAAARQnAQ",\n      "https://gw.alipayobjects.com/mdn/rms_7c464e/afts/img/A*8GF6Q4LZefUAAAAAAAAAAAAAARQnAQ",\n      "https://gw.alipayobjects.com/mdn/rms_7c464e/afts/img/A*D5pdRqUHC3IAAAAAAAAAAAAAARQnAQ",\n      "https://gw.alipayobjects.com/mdn/rms_7c464e/afts/img/A*_FooTIp6pNIAAAAAAAAAAAAAARQnAQ",\n      "https://gw.alipayobjects.com/mdn/rms_7c464e/afts/img/A*CYGZR7ogZfoAAAAAAAAAAAAAARQnAQ"\n    ],\n    type: AssetType.TextureCube\n  }\n];\n\nengine.resourceManager.load(resources).then((res) => {\n  const gltf = <GLTFResource>res[0];\n\n  let mesh = gltf.meshes[0];\n  for (let x = 0; x < 5; x++) {\n    for (let y = 0; y < 5; y++) {\n      let testNode = rootNode.createChild("test_mesh" + x + y);\n      testNode.addChild(gltf.defaultSceneRoot.clone());\n      testNode.transform.position = new Vector3((x - 2) * 5, (y - 2) * 5, 0);\n    }\n  }\n\n  envLight.diffuseTexture = <TextureCubeMap>res[1];\n  envLight.specularTexture = <TextureCubeMap>res[2];\n\n  // framebuffer picker\n  let lastMaterial;\n  let laseBaseColor;\n  let framebufferPicker = rootNode.addComponent(FramebufferPicker);\n  framebufferPicker.camera = camera;\n  framebufferPicker.onPick = (obj) => {\n    if (lastMaterial) lastMaterial.baseColor = laseBaseColor;\n\n    if (obj) {\n      const { primitive, component } = obj;\n      let material = component.getInstanceMaterial();\n\n      lastMaterial = material;\n      laseBaseColor = material.baseColor;\n      material.baseColor = new Color(1, 0, 0, 1);\n    }\n  };\n\n  document.getElementById("o3-demo").addEventListener("mousedown", (e) => {\n    // console.log(e.offsetX, e.offsetY);\n    framebufferPicker.pick(e.offsetX, e.offsetY);\n  });\n});\n\n//-- run\nengine.run();\n'}}]);